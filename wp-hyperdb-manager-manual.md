# HyperDB Manager for Multisite - 使用说明文档

## 📋 插件概述

HyperDB Manager 是一个专为 WordPress Multisite 环境设计的 HyperDB 图形化管理工具。它提供了直观的 Web 界面来管理数据库集群配置，支持读写分离、故障转移和性能监控。

**版本**: 1.0.0  
**适用**: WordPress 6.0+ / PHP 8.0+  
**类型**: 网络插件 (Network Plugin)  
**开发语言**: PHP + JavaScript  

---

## 🔧 系统要求

### 基础环境
- WordPress 6.0 或更高版本
- PHP 8.0 或更高版本
- MySQL 5.7+ 或 MariaDB 10.3+
- WordPress Multisite 网络已启用

### 依赖组件
- HyperDB 插件 (必需)
- 至少 1 个主数据库服务器
- 建议至少 1 个从数据库服务器

### 服务器权限
- wp-content 目录可写权限
- 数据库服务器连接权限
- 网络管理员权限

---

## 📦 安装步骤

### 第一步：安装 HyperDB
1. 下载 HyperDB 插件文件
2. 将 `db.php` 文件放置到 `wp-content/` 目录
3. 确保 HyperDB 正常工作

### 第二步：安装 HyperDB Manager
1. 将插件文件夹上传到 `wp-content/plugins/`
2. 进入网络管理后台 → 插件页面
3. 找到 "HyperDB Manager for Multisite"
4. 点击"网络启用"

### 第三步：验证安装
1. 检查网络管理菜单中是否出现 "HyperDB" 选项
2. 确认没有错误提示
3. 验证配置文件权限正常

---

## ⚙️ 配置说明

### 数据库服务器配置

#### 主数据库 (Master)
```
角色: 处理所有写操作和部分读操作
配置要求:
- 主机: 数据库服务器地址
- 数据库名: WordPress 数据库名
- 用户名: 具有读写权限的用户
- 密码: 数据库密码
- 类型: 选择"主库"
```

#### 从数据库 (Slave)
```
角色: 仅处理读操作，减轻主库压力
配置要求:
- 主机: 从库服务器地址
- 数据库名: 与主库同步的数据库
- 用户名: 具有读权限的用户
- 密码: 数据库密码
- 类型: 选择"从库"
```

### 推荐配置架构

#### 小型部署 (10-100 站点)
```
架构: 1 主 + 2 从
主库: 处理写操作
从库1: 处理前端读取
从库2: 处理管理后台读取
```

#### 中型部署 (100-1000 站点)
```
架构: 1 主 + 4 从
主库: 专用写操作
从库1-2: 前端内容读取
从库3-4: 管理功能读取
```

#### 大型部署 (1000+ 站点)
```
架构: 2 主 + 8 从 + 负载均衡
主库集群: 主从复制 + 故障转移
从库集群: 按功能和地域分组
负载均衡: ProxySQL 或 HAProxy
```

---

## 🖥️ 使用指南

### 访问管理界面
1. 登录 WordPress 网络管理后台
2. 点击左侧菜单 "HyperDB"
3. 进入数据库管理页面

### 连接状态监控
- **绿色圆点**: 数据库连接正常
- **红色圆点**: 数据库连接失败
- **延迟显示**: 复制延迟时间 (仅从库)

### 添加数据库服务器
1. 点击"添加数据库"按钮
2. 填写服务器连接信息
3. 选择服务器类型 (主库/从库)
4. 点击"测试"验证连接
5. 保存配置

### 修改数据库配置
1. 直接在表格中编辑相应字段
2. 密码字段留空表示保持不变
3. 点击"测试"验证新配置
4. 点击"保存配置"应用更改

### 备份配置
1. 点击"备份当前配置"按钮
2. 系统自动创建带时间戳的备份文件
3. 备份文件保存在 wp-content 目录

### 性能统计
- **总连接数**: 配置的数据库服务器总数
- **活跃连接**: 当前正常连接的服务器数
- **读查询**: 总读取查询数量
- **写查询**: 总写入查询数量

---

## 🎯 适用场景

### SaaS 平台
- **网站建设平台**: 类似 WordPress.com 的多租户服务
- **白标签解决方案**: 为代理商提供品牌定制
- **企业内容平台**: 大型企业多站点管理

### 电商营销
- **多品牌商城**: 统一管理不同品牌店铺
- **营销代理服务**: 为客户快速搭建营销站点
- **落地页平台**: 批量创建和管理落地页

### 媒体内容
- **新闻门户集群**: 处理高并发内容访问
- **博客托管服务**: 为用户提供专业博客平台
- **内容发布网络**: 支持大规模内容分发

### 教育培训
- **在线教育平台**: 为不同课程创建独立空间
- **企业培训系统**: 分部门或分项目的培训站点
- **学校网站集群**: 教育机构多校区管理

### 地域分布
- **连锁业务**: 为各地门店创建本地化网站
- **政府门户**: 省市县多级政府网站管理
- **区域服务**: 按地域提供定制化服务

---

## 🚨 故障排除

### 常见问题

#### 1. 插件激活失败
```
错误: "请先安装HyperDB"
解决: 
- 确认 wp-content/db.php 文件存在
- 检查 HyperDB 插件是否正确安装
- 验证文件权限设置
```

#### 2. 配置保存失败
```
错误: "配置文件写入失败"
解决:
- 检查 wp-content 目录写权限
- 确认 PHP 用户有文件操作权限
- 临时设置目录权限为 755 或 777
```

#### 3. 数据库连接测试失败
```
错误: "连接失败: Access denied"
解决:
- 验证数据库用户名和密码
- 检查数据库用户权限设置
- 确认数据库服务器允许远程连接
- 检查防火墙设置
```

#### 4. HyperDB 未正确加载
```
警告: "HyperDB未正确加载"
解决:
- 检查 db.php 文件是否在正确位置
- 验证 db-config.php 文件语法
- 检查 PHP 错误日志
- 重新生成配置文件
```

### 调试步骤
1. 启用 WordPress 调试模式
2. 检查 PHP 错误日志
3. 验证数据库服务器状态
4. 测试网络连接性
5. 检查文件权限设置

---

## ⚠️ 重要注意事项

### 安全考虑
- 定期更新数据库密码
- 使用专用数据库用户，避免 root 权限
- 启用 SSL 数据库连接 (生产环境)
- 定期备份配置文件

### 性能优化
- 合理设置连接超时时间
- 监控数据库复制延迟
- 根据负载调整从库数量
- 定期优化数据库索引

### 维护建议
- 每周检查连接状态
- 每月备份完整配置
- 定期更新插件版本
- 监控服务器资源使用

### 数据备份
- 配置文件自动备份
- 定期手动创建备份点
- 测试备份恢复流程
- 保留多个历史版本

---

## 🔍 技术规格

### 文件结构
```
hyperdb-manager/
├── hyperdb-manager.php        # 主插件文件
├── languages/                 # 语言文件目录
├── README.md                  # 说明文档
└── assets/                    # 资源文件 (如需要)
```

### 数据库表
```
使用 WordPress 标准表结构
配置存储在: wp-content/db-config.php
备份存储在: wp-content/db-config-backup*.php
```

### Hook 和 Filter
```
Actions:
- hyperdb_manager_before_save    # 配置保存前
- hyperdb_manager_after_save     # 配置保存后
- hyperdb_manager_connection_test # 连接测试时

Filters:
- hyperdb_manager_config_validation # 配置验证
- hyperdb_manager_backup_filename   # 备份文件名
```

---

## 📊 性能指标

### 推荐规格

| 站点规模 | 主库配置 | 从库配置 | 预期性能 |
|---------|---------|---------|---------|
| 小型 (10-100站点) | 2核4G | 2核2G | 1万PV/日 |
| 中型 (100-1000站点) | 4核8G | 4核4G | 10万PV/日 |
| 大型 (1000+站点) | 8核16G | 8核8G | 100万PV/日 |

### 监控指标
- 数据库连接数
- 查询响应时间
- 复制延迟时间
- 错误率统计
- 资源使用率

---

## 🆘 技术支持

### 问题反馈
如遇到问题，请提供以下信息：
- WordPress 版本
- PHP 版本
- HyperDB 版本
- 错误日志内容
- 服务器配置信息

### 联系方式
- 官方文档: [插件官网]
- 问题反馈: [Github Issues]
- 技术交流: [开发者社区]

### 开发信息
- 开发者: [开发者姓名]
- 许可证: GPL v2 or later
- 源代码: [Github 仓库地址]

---

## 📝 更新日志

### v1.0.0 (2024-06-15)
- 初始版本发布
- 支持基础数据库管理功能
- 实现连接测试和监控
- 添加配置备份功能
- 完整的用户界面

### 计划功能
- [ ] 自动故障转移
- [ ] 性能分析报告
- [ ] 邮件告警通知
- [ ] API 接口支持
- [ ] 集群健康检查

---

## 📄 许可证

本插件采用 GPL v2 或更高版本许可证发布。您可以自由使用、修改和分发本插件，但需要遵守相应的开源协议条款。

---

**注意**: 本插件仅供技术参考和学习使用，生产环境部署前请充分测试。使用本插件所产生的任何后果由使用者自行承担。

**最后更新**: 2024年6月15日